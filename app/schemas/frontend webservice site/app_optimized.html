<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>myRamadan</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        .page { display: none; }
        .page.active { display: block; }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-gradient-to-r from-emerald-700 to-emerald-500 text-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center py-4 px-4">
            <a href="#" onclick="showPage('home')" class="text-2xl font-bold cursor-pointer hover:opacity-80">üåô myRamadan</a>
            <nav class="hidden md:flex gap-6 items-center">
                <button onclick="showPage('home')" class="hover:text-gray-100">Home</button>
                <button onclick="showPage('analyzer')" class="hover:text-gray-100 font-bold text-yellow-200">‚ú® Ask AI</button>
                <button onclick="showPage('dua')" class="hover:text-gray-100">Dua Generator</button>
                <button onclick="showPage('videos')" class="hover:text-gray-100">üì∫ Videos</button>
            </nav>
        </div>
    </header>

    <!-- Login Modal -->
    <div id="loginModal" style="display: flex; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; align-items: center; justify-content: center;">
        <div style="background: white; border-radius: 16px; padding: 40px; max-width: 420px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 48px; margin-bottom: 10px;">üåô</div>
                <h1 style="color: #047857; font-size: 28px; font-weight: bold; margin: 0;">myRamadan</h1>
                <p style="color: #666; margin-top: 8px;">Your Islamic Companion</p>
            </div>
            
            <div id="loginTypeSelection">
                <button id="btnUserLogin" style="display: block; width: 100%; padding: 16px; margin-bottom: 12px; background: #047857; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                    üë§ Login as User
                </button>
                <button id="btnImamLogin" style="display: block; width: 100%; padding: 16px; background: #2563eb; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">
                    üïå Login as Imam
                </button>
            </div>
            
            <div id="userLoginForm" style="display: none;">
                <h3 style="color: #047857; font-size: 20px; font-weight: bold; margin-bottom: 20px;">üë§ User Login</h3>
                <input type="email" id="userEmailInput" placeholder="your.email@example.com" style="width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px;">
                <p id="userEmailError" style="color: #dc2626; font-size: 12px; margin-bottom: 8px; display: none;"></p>
                <input type="text" id="userNameInput" placeholder="Your name" style="width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 16px;">
                <button id="btnSubmitUserLogin" style="display: block; width: 100%; padding: 16px; margin-bottom: 12px; background: #047857; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">‚úì Login</button>
                <button id="btnBackFromUser" style="display: block; width: 100%; padding: 14px; background: #e5e7eb; color: #374151; border: none; border-radius: 10px; font-size: 16px; cursor: pointer;">‚Üê Back</button>
                <div id="userLoginStatus" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
            </div>
            
            <div id="imamLoginForm" style="display: none;">
                <h3 style="color: #2563eb; font-size: 20px; font-weight: bold; margin-bottom: 20px;">üïå Imam Login</h3>
                <input type="text" id="imamNameInput" placeholder="Your full name" style="width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px;">
                <input type="email" id="imamEmailInput" placeholder="your.email@example.com" style="width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 12px;">
                <input type="password" id="imamPasswordInput" placeholder="Password" style="width: 100%; padding: 14px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; box-sizing: border-box; margin-bottom: 16px;">
                <button id="btnSubmitImamLogin" style="display: block; width: 100%; padding: 16px; margin-bottom: 12px; background: #2563eb; color: white; border: none; border-radius: 10px; font-size: 18px; font-weight: bold; cursor: pointer;">‚úì Login as Imam</button>
                <button id="btnBackFromImam" style="display: block; width: 100%; padding: 14px; background: #e5e7eb; color: #374151; border: none; border-radius: 10px; font-size: 16px; cursor: pointer;">‚Üê Back</button>
                <div id="imamLoginStatus" style="margin-top: 16px; padding: 12px; border-radius: 8px; display: none;"></div>
            </div>
        </div>
    </div>

    <!-- User Profile Header -->
    <div id="userProfileHeader" class="hidden bg-gradient-to-r from-emerald-600 to-emerald-500 text-white py-3 px-4">
        <div class="container mx-auto flex justify-between items-center">
            <div><span id="userTypeDisplay"></span> <span id="userNameDisplay" class="ml-2 font-semibold"></span></div>
            <button onclick="logout()" class="px-4 py-2 bg-white text-emerald-700 font-semibold rounded hover:bg-gray-100">Logout</button>
        </div>
    </div>

    <!-- HOME PAGE -->
    <div id="home" class="page active">
        <main class="container mx-auto py-12 px-4">
            <div id="backendStatus" class="mb-6 text-center">
                <div id="statusIndicator" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-yellow-100 text-yellow-800">
                    <span class="animate-pulse">‚óè</span> Checking services...
                </div>
            </div>
            
            <div class="text-center mb-12">
                <h1 class="text-5xl font-bold text-emerald-700 mb-4">Welcome to myRamadan</h1>
                <p class="text-xl text-gray-600 mb-8">Your personal Islamic companion for duas, guidance, and spiritual connection</p>
                
                <div class="flex gap-4 justify-center mb-8 flex-wrap">
                    <button onclick="showPage('analyzer')" class="px-8 py-4 bg-gradient-to-r from-emerald-600 to-emerald-700 text-white font-bold rounded-xl hover:from-emerald-700 hover:to-emerald-800 shadow-lg text-lg">ü§ñ Ask AI</button>
                    <button onclick="showPage('dua')" class="px-8 py-4 bg-gradient-to-r from-blue-600 to-blue-700 text-white font-bold rounded-xl hover:from-blue-700 hover:to-blue-800 shadow-lg text-lg">üìø Generate Dua</button>
                    <button onclick="showPage('videos')" class="px-8 py-4 bg-gradient-to-r from-red-600 to-red-700 text-white font-bold rounded-xl hover:from-red-700 hover:to-red-800 shadow-lg text-lg">üì∫ Islamic Videos</button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-12">
                <div onclick="showPage('analyzer')" class="bg-gradient-to-br from-emerald-50 to-white rounded-lg shadow p-6 hover:shadow-lg cursor-pointer border-2 border-emerald-200">
                    <div class="text-4xl mb-4">ü§ñ</div>
                    <h2 class="text-2xl font-bold text-emerald-700 mb-3">Ask AI</h2>
                    <p class="text-gray-600">Get Quran ayahs & Hadiths with AI-powered explanations</p>
                    <span class="inline-block mt-3 px-3 py-1 bg-emerald-100 text-emerald-700 rounded-full text-sm font-semibold">‚ú® AI Powered</span>
                </div>

                <div onclick="showPage('dua')" class="bg-white rounded-lg shadow p-6 hover:shadow-lg cursor-pointer">
                    <div class="text-4xl mb-4">üìø</div>
                    <h2 class="text-2xl font-bold text-emerald-700 mb-3">Dua Generator</h2>
                    <p class="text-gray-600">Get personalized duas in English and Arabic</p>
                    <span class="inline-block mt-3 px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold">‚ú® AI Powered</span>
                </div>

                <div onclick="showPage('videos')" class="bg-white rounded-lg shadow p-6 hover:shadow-lg cursor-pointer">
                    <div class="text-4xl mb-4">üì∫</div>
                    <h2 class="text-2xl font-bold text-emerald-700 mb-3">Islamic Videos</h2>
                    <p class="text-gray-600">Find Islamic videos on YouTube</p>
                    <span class="inline-block mt-3 px-3 py-1 bg-red-100 text-red-700 rounded-full text-sm font-semibold">YouTube</span>
                </div>
            </div>

            <div class="bg-emerald-100 rounded-lg p-8">
                <h2 class="text-3xl font-bold text-emerald-700 mb-4">About myRamadan</h2>
                <p class="text-gray-700">myRamadan is designed to support your spiritual journey. We combine Islamic scholarship with AI technology to provide personalized guidance, duas, and resources.</p>
            </div>
        </main>
    </div>

    <!-- DUA GENERATOR PAGE -->
    <div id="dua" class="page">
        <main class="container mx-auto py-12 px-4">
            <h1 class="text-4xl font-bold text-emerald-700 mb-8 text-center">Personalized Dua Generator</h1>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-6">Tell us your need</h2>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Select Category</label>
                        <select id="duaCategory" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:border-emerald-700 outline-none">
                            <option>Fear & Anxiety</option>
                            <option>Financial Hardship</option>
                            <option>Health Issues</option>
                            <option>Family Problems</option>
                            <option>Career Guidance</option>
                            <option>Spiritual Growth</option>
                            <option>Relationship Issues</option>
                        </select>
                    </div>

                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Your Situation</label>
                        <textarea id="duaContext" placeholder="Describe your situation in detail..." rows="5" class="w-full px-4 py-3 border-2 border-gray-300 rounded-lg resize-none focus:border-emerald-700 outline-none"></textarea>
                    </div>

                    <button onclick="generateDua()" id="generateDuaBtn" class="w-full px-6 py-4 bg-emerald-700 text-white font-bold rounded-lg hover:bg-emerald-600 text-lg">üìø Generate My Dua</button>
                </div>

                <div id="duaOutput" class="hidden bg-gradient-to-br from-emerald-50 to-white rounded-lg shadow p-6">
                    <h2 class="text-2xl font-bold text-emerald-700 mb-6">Your Personalized Dua</h2>

                    <div class="mb-6 p-4 bg-white rounded-lg border-l-4 border-emerald-700">
                        <h3 class="font-semibold text-emerald-700 mb-2">üá¨üáß English</h3>
                        <p id="duaEn" class="text-gray-800 text-lg italic"></p>
                    </div>

                    <div class="mb-6 p-4 bg-white rounded-lg border-l-4 border-blue-600 text-right" dir="rtl">
                        <h3 class="font-semibold text-blue-700 mb-2">üá∏üá¶ Arabic</h3>
                        <p id="duaAr" class="text-gray-800 text-lg"></p>
                    </div>

                    <div class="p-4 bg-gray-50 rounded-lg">
                        <h3 class="font-semibold text-gray-700 mb-2">üìñ How to use</h3>
                        <p id="duaInstructions" class="text-gray-600"></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- AI ANALYZER PAGE -->
    <div id="analyzer" class="page">
        <main class="container mx-auto py-12 px-4">
            <h1 class="text-4xl font-bold text-emerald-700 mb-4 text-center">Ask AI - Islamic Guidance</h1>
            <p class="text-center text-gray-600 mb-8 text-lg">Get Quran Ayahs & Hadiths with AI explanations</p>

            <div class="max-w-3xl mx-auto">
                <div class="bg-white rounded-lg shadow p-8 mb-8">
                    <textarea id="promptInput" placeholder="Ask any Islamic question... (e.g., 'How do I deal with anxiety?' or 'What is the importance of patience?')" class="w-full px-4 py-4 border-2 border-gray-300 rounded-lg focus:border-emerald-700 outline-none resize-none" rows="4"></textarea>
                    <button onclick="analyzePrompt()" id="analyzeBtn" class="w-full mt-4 px-6 py-4 bg-emerald-700 text-white font-bold text-lg rounded-lg hover:bg-emerald-600">ü§ñ Analyze with AI</button>
                </div>

                <div id="analyzerLoading" class="text-center mb-8 hidden">
                    <div class="inline-block">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-700"></div>
                        <p class="text-emerald-700 font-semibold mt-2">Analyzing your question...</p>
                    </div>
                </div>

                <div id="analyzerResults" class="hidden space-y-6">
                    <div class="bg-blue-50 rounded-lg shadow p-6">
                        <h2 class="text-2xl font-bold text-blue-900 mb-4">ü§ñ AI Analysis</h2>
                        <p id="aiExplanation" class="text-gray-800 leading-relaxed"></p>
                    </div>

                    <div class="bg-emerald-50 rounded-lg shadow p-6">
                        <h2 class="text-2xl font-bold text-emerald-700 mb-4">üìñ Quranic Verse</h2>
                        <div class="bg-white rounded p-4 mb-4">
                            <p id="ayahArabic" class="text-xl text-gray-800 text-right mb-2" dir="rtl"></p>
                            <p id="ayahReference" class="text-sm text-emerald-600 font-semibold"></p>
                        </div>
                        <p id="ayahTranslation" class="text-gray-700 mb-4"></p>
                        <p id="ayahExplanation" class="text-gray-600 text-sm"></p>
                    </div>

                    <div class="bg-orange-50 rounded-lg shadow p-6">
                        <h2 class="text-2xl font-bold text-orange-800 mb-4">üìö Related Hadith</h2>
                        <div class="bg-white rounded p-4 mb-4">
                            <p id="hadithText" class="text-gray-800"></p>
                            <p id="hadithSource" class="text-sm text-orange-600 font-semibold mt-2"></p>
                        </div>
                        <p id="hadithExplanation" class="text-gray-600"></p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- ISLAMIC VIDEOS PAGE -->
    <div id="videos" class="page">
        <main class="container mx-auto py-12 px-4">
            <h1 class="text-4xl font-bold text-emerald-700 mb-2 text-center">üì∫ Islamic Videos</h1>
            <p class="text-center text-gray-600 mb-8 text-lg">Search for Islamic educational videos on YouTube</p>

            <div class="max-w-3xl mx-auto">
                <div class="bg-white rounded-lg shadow p-8 mb-8">
                    <label class="block text-sm font-semibold text-gray-700 mb-2">What would you like to learn about?</label>
                    <textarea id="videoSearchPrompt" placeholder="e.g., 'How to improve my prayer concentration', 'Understanding Surah Al-Fatiha', 'Tips for fasting during Ramadan'" class="w-full px-4 py-4 border-2 border-gray-300 rounded-lg focus:border-emerald-700 outline-none resize-none" rows="3"></textarea>
                    <button onclick="searchIslamicVideos()" id="searchVideoBtn" class="w-full mt-4 px-6 py-4 bg-red-600 text-white font-bold text-lg rounded-lg hover:bg-red-700">üîç Search Islamic Videos</button>
                </div>

                <div id="videoLoading" class="text-center mb-8 hidden">
                    <div class="inline-block">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-red-600"></div>
                        <p class="text-red-600 font-semibold mt-2">Searching for videos...</p>
                    </div>
                </div>

                <div id="videoResults" class="hidden">
                    <div class="bg-blue-50 rounded-lg p-4 mb-6">
                        <p class="text-blue-800"><strong>Search:</strong> <span id="videoSearchQuery"></span></p>
                    </div>
                    
                    <div id="videosGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                    
                    <div id="noVideosMessage" class="hidden bg-yellow-50 border-2 border-yellow-300 rounded-lg p-6 text-center">
                        <p class="text-yellow-800 font-semibold">No videos found. Try a different search term.</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white text-center py-6 mt-12">
        <p>¬© 2026 myRamadan. May Allah accept from us. üåô</p>
    </footer>

    <script>
        // ============= CONFIGURATION =============
        const API_BASE_URL = "http://localhost:8000/api";
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;
        let currentImam = JSON.parse(localStorage.getItem('currentImam')) || null;
        let userEmail = localStorage.getItem('userEmail') || '';

        // ============= INITIALIZATION =============
        document.addEventListener('DOMContentLoaded', function() {
            initLogin();
            checkBackendStatus();
        });

        // ============= BACKEND STATUS =============
        async function checkBackendStatus() {
            const indicator = document.getElementById('statusIndicator');
            try {
                const response = await fetch('http://localhost:8000/', { method: 'GET' });
                if (response.ok) {
                    indicator.className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full bg-green-100 text-green-800';
                    indicator.innerHTML = '<span class="text-green-500">‚óè</span> All services online';
                }
            } catch (error) {
                indicator.className = 'inline-flex items-center gap-2 px-4 py-2 rounded-full bg-red-100 text-red-800';
                indicator.innerHTML = '<span class="text-red-500">‚óè</span> Backend offline - Start backend server';
            }
        }

        // ============= LOGIN SYSTEM =============
        function initLogin() {
            const loginModal = document.getElementById('loginModal');
            const loginTypeSelection = document.getElementById('loginTypeSelection');
            const userLoginForm = document.getElementById('userLoginForm');
            const imamLoginForm = document.getElementById('imamLoginForm');

            // Check if already logged in
            if (currentUser || currentImam) {
                loginModal.style.display = 'none';
                document.getElementById('userProfileHeader').classList.remove('hidden');
                if (currentUser) {
                    document.getElementById('userTypeDisplay').textContent = 'üë§ User';
                    document.getElementById('userNameDisplay').textContent = currentUser.name || currentUser.email;
                    userEmail = currentUser.email;
                }
                if (currentImam) {
                    document.getElementById('userTypeDisplay').textContent = 'üïå Imam';
                    document.getElementById('userNameDisplay').textContent = currentImam.name;
                }
                return;
            }

            // Button handlers
            document.getElementById('btnUserLogin').onclick = () => {
                loginTypeSelection.style.display = 'none';
                userLoginForm.style.display = 'block';
            };

            document.getElementById('btnImamLogin').onclick = () => {
                loginTypeSelection.style.display = 'none';
                imamLoginForm.style.display = 'block';
            };

            document.getElementById('btnBackFromUser').onclick = () => {
                loginTypeSelection.style.display = 'block';
                userLoginForm.style.display = 'none';
            };

            document.getElementById('btnBackFromImam').onclick = () => {
                loginTypeSelection.style.display = 'block';
                imamLoginForm.style.display = 'none';
            };

            document.getElementById('btnSubmitUserLogin').onclick = async () => {
                const email = document.getElementById('userEmailInput').value.trim();
                const name = document.getElementById('userNameInput').value.trim() || email.split('@')[0];
                const errorEl = document.getElementById('userEmailError');
                const statusEl = document.getElementById('userLoginStatus');

                if (!email || !email.includes('@') || !email.includes('.')) {
                    errorEl.textContent = 'Please enter a valid email address';
                    errorEl.style.display = 'block';
                    return;
                }

                // Validate email domain
                const domain = email.split('@')[1].toLowerCase();
                const fakeDomains = ['test.com', 'example.com', 'fake.com', 'mailinator.com'];
                if (fakeDomains.includes(domain)) {
                    errorEl.textContent = 'Please use a real email address';
                    errorEl.style.display = 'block';
                    return;
                }

                errorEl.style.display = 'none';
                statusEl.style.display = 'block';
                statusEl.style.background = '#d1fae5';
                statusEl.style.color = '#047857';
                statusEl.textContent = '‚úÖ Login successful!';

                currentUser = { type: 'user', email, name, loginTime: new Date().toISOString() };
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                localStorage.setItem('userEmail', email);
                userEmail = email;

                setTimeout(() => {
                    loginModal.style.display = 'none';
                    document.getElementById('userProfileHeader').classList.remove('hidden');
                    document.getElementById('userTypeDisplay').textContent = 'üë§ User';
                    document.getElementById('userNameDisplay').textContent = name;
                }, 500);
            };

            document.getElementById('btnSubmitImamLogin').onclick = async () => {
                const name = document.getElementById('imamNameInput').value.trim();
                const email = document.getElementById('imamEmailInput').value.trim();
                const password = document.getElementById('imamPasswordInput').value.trim();
                const statusEl = document.getElementById('imamLoginStatus');

                if (!name || !email || !password) {
                    statusEl.style.display = 'block';
                    statusEl.style.background = '#fee2e2';
                    statusEl.style.color = '#dc2626';
                    statusEl.textContent = '‚ùå Please fill all fields';
                    return;
                }

                statusEl.style.display = 'block';
                statusEl.style.background = '#dbeafe';
                statusEl.style.color = '#1d4ed8';
                statusEl.textContent = '‚úÖ Login successful!';

                currentImam = { type: 'imam', name, email, loginTime: new Date().toISOString() };
                localStorage.setItem('currentImam', JSON.stringify(currentImam));

                setTimeout(() => {
                    loginModal.style.display = 'none';
                    document.getElementById('userProfileHeader').classList.remove('hidden');
                    document.getElementById('userTypeDisplay').textContent = 'üïå Imam';
                    document.getElementById('userNameDisplay').textContent = name;
                }, 500);
            };
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('currentUser');
                localStorage.removeItem('currentImam');
                localStorage.removeItem('userEmail');
                location.reload();
            }
        }

        // ============= PAGE NAVIGATION =============
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            window.scrollTo(0, 0);
        }

        // ============= DUA GENERATOR =============
        async function generateDua() {
            const category = document.getElementById('duaCategory').value;
            const context = document.getElementById('duaContext').value.trim();
            const btn = document.getElementById('generateDuaBtn');
            const output = document.getElementById('duaOutput');

            if (!context) {
                alert('Please describe your situation');
                return;
            }

            btn.disabled = true;
            btn.textContent = '‚è≥ Generating...';
            output.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/dua/generate`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail || 'guest@app.local', category, context })
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('duaEn').textContent = data.dua_text_en;
                    document.getElementById('duaAr').textContent = data.dua_text_ar;
                    document.getElementById('duaInstructions').textContent = data.how_to_use_en || 'Recite with sincerity and focus.';
                    output.classList.remove('hidden');
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                alert('Error generating dua. Make sure backend is running.');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üìø Generate My Dua';
            }
        }

        // ============= AI ANALYZER =============
        async function analyzePrompt() {
            const prompt = document.getElementById('promptInput').value.trim();
            const btn = document.getElementById('analyzeBtn');
            const loading = document.getElementById('analyzerLoading');
            const results = document.getElementById('analyzerResults');

            if (!prompt) {
                alert('Please enter your question');
                return;
            }

            btn.disabled = true;
            loading.classList.remove('hidden');
            results.classList.add('hidden');

            try {
                const response = await fetch(`${API_BASE_URL}/analyzer/analyze`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email: userEmail || 'guest@app.local', question: prompt })
                });

                if (response.ok) {
                    const data = await response.json();
                    
                    document.getElementById('aiExplanation').textContent = data.ai_explanation;
                    document.getElementById('ayahArabic').textContent = data.ayah.arabic;
                    document.getElementById('ayahReference').textContent = 'üìç ' + data.ayah.reference;
                    document.getElementById('ayahTranslation').textContent = data.ayah.translation;
                    document.getElementById('ayahExplanation').textContent = data.ayah.explanation;
                    document.getElementById('hadithText').textContent = data.hadith.text;
                    document.getElementById('hadithSource').textContent = 'üìö ' + data.hadith.narrator;
                    document.getElementById('hadithExplanation').textContent = data.hadith.explanation;
                    
                    results.classList.remove('hidden');
                } else {
                    throw new Error('API error');
                }
            } catch (error) {
                alert('Error analyzing question. Make sure backend is running.');
            } finally {
                btn.disabled = false;
                loading.classList.add('hidden');
            }
        }

        // ============= VIDEO SEARCH (Direct YouTube) =============
        async function searchIslamicVideos() {
            const prompt = document.getElementById('videoSearchPrompt').value.trim();
            const btn = document.getElementById('searchVideoBtn');
            const loading = document.getElementById('videoLoading');
            const results = document.getElementById('videoResults');
            const grid = document.getElementById('videosGrid');
            const noVideos = document.getElementById('noVideosMessage');

            if (!prompt) {
                alert('Please describe what you want to learn about');
                return;
            }

            btn.disabled = true;
            btn.textContent = '‚è≥ Searching...';
            loading.classList.remove('hidden');
            results.classList.add('hidden');

            try {
                // First, try to get AI-generated search keywords from backend
                let searchQuery = prompt + ' Islamic lecture';
                
                try {
                    const aiResponse = await fetch(`${API_BASE_URL}/videos/search-by-prompt`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ email: userEmail || 'guest@app.local', prompt })
                    });
                    
                    if (aiResponse.ok) {
                        const aiData = await aiResponse.json();
                        searchQuery = aiData.search_query || searchQuery;
                    }
                } catch (e) {
                    console.log('Using default search query');
                }

                document.getElementById('videoSearchQuery').textContent = searchQuery;

                // Use YouTube search URL approach - display video cards that link to YouTube search
                const islamicChannels = [
                    { name: 'Mufti Menk', query: searchQuery + ' Mufti Menk' },
                    { name: 'Omar Suleiman', query: searchQuery + ' Omar Suleiman' },
                    { name: 'Nouman Ali Khan', query: searchQuery + ' Nouman Ali Khan' },
                    { name: 'Yasir Qadhi', query: searchQuery + ' Yasir Qadhi' },
                    { name: 'Islamic Guidance', query: searchQuery + ' Islamic lecture' },
                    { name: 'FreeQuranEducation', query: searchQuery + ' Quran' }
                ];

                grid.innerHTML = islamicChannels.map(channel => `
                    <div class="bg-white rounded-lg shadow hover:shadow-lg overflow-hidden">
                        <div class="bg-gradient-to-br from-red-600 to-red-700 h-32 flex items-center justify-center">
                            <span class="text-6xl">üì∫</span>
                        </div>
                        <div class="p-4">
                            <h3 class="font-bold text-gray-900 mb-2">${channel.name}</h3>
                            <p class="text-sm text-gray-600 mb-4">Search for: "${prompt}"</p>
                            <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(channel.query)}" 
                               target="_blank" 
                               class="block w-full text-center px-4 py-3 bg-red-600 text-white font-semibold rounded hover:bg-red-700">
                                üîç Search on YouTube
                            </a>
                        </div>
                    </div>
                `).join('');

                noVideos.classList.add('hidden');
                results.classList.remove('hidden');

            } catch (error) {
                console.error('Error:', error);
                alert('Error searching videos');
            } finally {
                btn.disabled = false;
                btn.textContent = 'üîç Search Islamic Videos';
                loading.classList.add('hidden');
            }
        }
    </script>
</body>
</html>
